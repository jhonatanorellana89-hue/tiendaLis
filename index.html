<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Control Económico — Resumen PDF</title>
<link href="https://cdn.jsdelivr.net/npm/modern-normalize/modern-normalize.css" rel="stylesheet">
<style>
  body { font-family: Inter, system-ui, Arial; background: #f6f7fb; margin: 18px; color: #0f172a; }
  .card { background: #fff; border-radius: 10px; padding: 16px; box-shadow: 0 6px 18px rgba(12,16,35,0.06); max-width: 900px; margin: auto; }
  h2 { text-align: center; margin-bottom: 12px; }
  section { margin-bottom: 24px; }
  table { width: 100%; border-collapse: collapse; font-size: 14px; }
  th, td { padding: 8px; border-bottom: 1px solid #ddd; text-align: left; }
  th { background: #eefbf9; color: #055e52; }
  button { cursor: pointer; background: #0f766e; color: white; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 700; }
  button:hover { background: #055e52; }
  .muted { color: #6b7280; font-size: 13px; margin-bottom: 8px; text-align: center; }
</style>
</head>
<body>

<div class="card">
  <h2>Control Económico — Resumen Financiero</h2>
  <div class="muted" id="reportDate"></div>

  <section>
    <h3>Bancos</h3>
    <table id="tblBanks">
      <thead><tr><th>Banco</th><th>Saldo</th><th>Tipo</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h3>Deudas vinculadas a banco</h3>
    <table id="tblDebts">
      <thead><tr><th>Acreedor</th><th>Total</th><th>Meses a pagar</th><th>Pago mensual</th><th>Banco asociado</th><th>Saldo pendiente</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h3>Pasivos (Costo mensual)</h3>
    <table id="tblLiabs">
      <thead><tr><th>Concepto</th><th>Cuota mensual</th><th>Banco vinculado</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h3>Registro de bienes activos y pasivos</h3>
    <table id="tblGoods">
      <thead><tr><th>Bien</th><th>Tipo</th><th>Valor</th><th>Ingreso / Costo mensual</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <div style="text-align:center; margin-top:20px;">
    <button id="btnGeneratePDF">Generar Reporte PDF</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  // Mock state data for demo - replace or load from your actual data logic
  const state = {
    banks: [
      {id:'b1', name:'Banco A', balance: 5000, type:'ahorro'},
      {id:'b2', name:'Banco B', balance: 2000, type:'corriente'}
    ],
    debts: [
      {id:'d1', creditor:'Tarjeta de crédito', total: 1200, months:12, monthly: 100, bankId:'b1', remaining: 800},
      {id:'d2', creditor:'Préstamo personal', total: 6000, months:24, monthly: 250, bankId:'b2', remaining: 3000}
    ],
    liabs: [
      {id:'l1', name:'Pago mensual alquiler', monthly: 1500, bankId:'b1'},
      {id:'l2', name:'Servicio de internet', monthly: 100, bankId:null}
    ],
    goods: [
      {id:'g1', name:'Auto', type:'pasivo', valor:12000, monthly:-300},
      {id:'g2', name:'Departamento', type:'activo', valor:350000, monthly:1500}
    ],
  };

  // Format currency
  function formatCur(v){ return 'S/ '+Number(v||0).toLocaleString(); }

  // Render table
  function renderTable(){
    const tbBanks = document.querySelector('#tblBanks tbody');
    tbBanks.innerHTML = '';
    state.banks.forEach(b => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${b.name}</td><td>${formatCur(b.balance)}</td><td>${b.type}</td>`;
      tbBanks.appendChild(tr);
    });

    const tbDebts = document.querySelector('#tblDebts tbody');
    tbDebts.innerHTML = '';
    state.debts.forEach(d => {
      const bankName = state.banks.find(b => b.id === d.bankId)?.name || '';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${d.creditor}</td>
        <td>${formatCur(d.total)}</td>
        <td>${d.months}</td>
        <td>${formatCur(d.monthly)}</td>
        <td>${bankName}</td>
        <td>${formatCur(d.remaining)}</td>
      `;
      tbDebts.appendChild(tr);
    });

    const tbLiabs = document.querySelector('#tblLiabs tbody');
    tbLiabs.innerHTML = '';
    state.liabs.forEach(l => {
      const bankName = state.banks.find(b => b.id === l.bankId)?.name || '';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${l.name}</td><td>${formatCur(l.monthly)}</td><td>${bankName}</td>`;
      tbLiabs.appendChild(tr);
    });

    const tbGoods = document.querySelector('#tblGoods tbody');
    tbGoods.innerHTML = '';
    state.goods.forEach(g => {
      const monthlyStr = g.type === 'activo' ? formatCur(g.monthly) : formatCur(-Math.abs(g.monthly));
      const tr= document.createElement('tr');
      tr.innerHTML = `<td>${g.name}</td><td>${g.type}</td><td>${formatCur(g.valor)}</td><td>${monthlyStr}</td>`;
      tbGoods.appendChild(tr);
    });

    // Set report date
    const today = new Date();
    document.getElementById('reportDate').textContent = `Reporte generado el: ${today.toLocaleDateString('es-PE')}`;
  }

  // Generate PDF report using jsPDF
  async function generatePDF(){
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    let y = 10;
    pdf.setFontSize(16);
    pdf.text('Control Económico — Resumen Financiero', 14, y);
    y += 8;
    pdf.setFontSize(11);
    pdf.text(`Fecha: ${new Date().toLocaleDateString('es-PE')}`, 14, y);
    y += 10;

    function addSection(title){
      pdf.setFontSize(14);
      pdf.text(title, 14, y);
      y += 8;
    }
    function addTable(headers, rows){
      pdf.setFontSize(11);
      let startY = y;
      pdf.autoTable({
        startY: y,
        head: [headers],
        body: rows,
        theme: 'grid',
        styles: {fontSize: 9},
        margin: {left:14, right:14},
        didDrawPage: function (data) {
          y = data.cursor.y + 10;
        }
      });
    }

    // Note: jsPDF requires autotable plugin, include CDN
    // For simplicity, including CDN here:
    if(!window.jspdf || !window.jspdf.autoTable){
      alert("Falta la librería jsPDF autoTable. Incluye este script:\n<script src='https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js'></script>");
      return;
    }

    addSection('Bancos');
    addTable(
      ['Banco', 'Saldo', 'Tipo'],
      state.banks.map(b => [b.name, formatCur(b.balance), b.type])
    );

    addSection('Deudas vinculadas a banco');
    addTable(
      ['Acreedor', 'Total', 'Meses a pagar', 'Pago mensual', 'Banco asociado', 'Saldo pendiente'],
      state.debts.map(d => [
        d.creditor,
        formatCur(d.total),
        d.months.toString(),
        formatCur(d.monthly),
        state.banks.find(b => b.id === d.bankId)?.name || '',
        formatCur(d.remaining)
      ])
    );

    addSection('Pasivos (Costo mensual)');
    addTable(
      ['Concepto', 'Cuota mensual', 'Banco vinculado'],
      state.liabs.map(l => [
        l.name,
        formatCur(l.monthly),
        state.banks.find(b => b.id === l.bankId)?.name || ''
      ])
    );

    addSection('Registro de bienes activos y pasivos');
    addTable(
      ['Bien', 'Tipo', 'Valor', 'Ingreso / Costo mensual'],
      state.goods.map(g => [
        g.name,
        g.type,
        formatCur(g.valor),
        g.type === 'activo' ? formatCur(g.monthly) : formatCur(-Math.abs(g.monthly))
      ])
    );

    pdf.save(`ControlEconómico_Resumen_${new Date().toISOString().slice(0,10)}.pdf`);
  }

  document.getElementById('btnGeneratePDF').onclick = generatePDF;

  // Initial table render
  renderTable();
</script>

<!-- jsPDF autotable needed for tables in PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

</body>
</html>


