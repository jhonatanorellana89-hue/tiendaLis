<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Control Financiero Empresarial</title>
<style>
  :root {
    --primary-color: #0f766e;
    --background: #f6f7fb;
    --card-bg: #fff;
    --text-color: #0f172a;
    --muted: #6b7280;
    --accent: #34d399;
  }
  body {
    margin: 0; font-family: 'Inter', system-ui, sans-serif; background: var(--background); color: var(--text-color);
  }
  header, footer {
    background: var(--primary-color); color: white; padding: 1rem; text-align: center;
  }
  main {
    max-width: 1100px; margin: 1rem auto; padding: 0 1rem;
  }
  nav {
    display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem;
  }
  nav button {
    background: transparent; border: none; padding: 0.5rem 1rem; font-weight: 700; color: var(--primary-color);
    cursor: pointer; border-radius: 0.5rem; transition: background-color 0.3s, color 0.3s;
  }
  nav button.active, nav button:hover {
    background: var(--primary-color); color: white;
  }
  section {
    display: none; background: var(--card-bg); border-radius: 12px; padding: 1rem;
    box-shadow: 0 6px 18px rgba(12, 16, 35, 0.06); margin-bottom: 1rem;
  }
  section.active {
    display: block;
  }
  h2 {
    margin-top: 0;
  }
  label {
    display: block; margin-top: 0.5rem; font-weight: 600;
  }
  input, select, textarea {
    width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid #e6e9ef; margin-top: 0.25rem;
    font-size: 1rem; box-sizing: border-box;
  }
  button.btn {
    margin-top: 1rem; background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;
    font-weight: 700;
  }
  table {
    width: 100%; border-collapse: collapse; margin-top: 1rem;
  }
  th, td {
    padding: 0.75rem; border-bottom: 1px solid #f1f3f6; text-align: left; font-size: 0.9rem;
  }
  th {
    cursor: pointer; user-select: none; background: #f9fafb;
  }
  canvas {
    max-width: 100%; height: 250px;
  }
  .notification {
    position: fixed; top: 20px; right: 20px; background: #34d399; color: white; padding: 0.75rem 1rem;
    border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.15); opacity: 0; transition: opacity 0.3s;
    pointer-events: none; z-index: 1000;
  }
  .notification.show {
    opacity: 1; pointer-events: auto;
  }
</style>
</head>
<body>
<header><h1>Control Financiero Empresarial</h1></header>
<nav>
  <button class="nav-btn active" data-section="dashboard">Dashboard</button>
  <button class="nav-btn" data-section="assets">Activos</button>
  <button class="nav-btn" data-section="liabilities">Pasivos</button>
  <button class="nav-btn" data-section="expenses">Gastos</button>
  <button class="nav-btn" data-section="incomes">Ingresos</button>
  <button class="nav-btn" data-section="goals">Metas</button>
  <button class="nav-btn" data-section="simulator">Simulador</button>
</nav>
<main>
  <!-- Dashboard -->
  <section id="dashboard" class="active">
    <h2>Resumen Financiero</h2>
    <div>
      <canvas id="summaryChart"></canvas>
    </div>
    <div style="margin-top:1rem;">
      <p><strong>Balance Disponible:</strong> <span id="balanceDisplay"></span></p>
      <p><strong>Ahorros:</strong> <span id="savingsDisplay"></span></p>
      <p><strong>Ingresos Pasivos:</strong> <span id="passiveIncomeDisplay"></span></p>
      <p><strong>Gastos Fijos:</strong> <span id="fixedExpensesDisplay"></span></p>
    </div>
  </section>

  <!-- Activos -->
  <section id="assets">
    <h2>Activos</h2>
    <form id="assetForm">
      <label for="assetName">Nombre del Activo</label>
      <input type="text" id="assetName" required />
      <label for="assetValue">Valor ($)</label>
      <input type="number" id="assetValue" min="0" step="0.01" required />
      <label for="assetIncome">Ingreso Mensual Estimado ($)</label>
      <input type="number" id="assetIncome" min="0" step="0.01" />
      <button type="submit" class="btn">Agregar Activo</button>
    </form>
    <table id="assetsTable">
      <thead>
        <tr><th>Nombre</th><th>Valor</th><th>Ingreso Mensual</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Pasivos -->
  <section id="liabilities">
    <h2>Pasivos</h2>
    <form id="liabilityForm">
      <label for="liabName">Nombre del Pasivo</label>
      <input type="text" id="liabName" required />
      <label for="liabTotal">Total ($)</label>
      <input type="number" id="liabTotal" min="0" step="0.01" required />
      <label for="liabMonthly">Cuota Mensual ($)</label>
      <input type="number" id="liabMonthly" min="0" step="0.01" required />
      <button type="submit" class="btn">Agregar Pasivo</button>
    </form>
    <table id="liabilitiesTable">
      <thead>
        <tr><th>Nombre</th><th>Total</th><th>Cuota Mensual</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Gastos -->
  <section id="expenses">
    <h2>Gastos</h2>
    <form id="expenseForm">
      <label for="expenseName">Nombre del Gasto</label>
      <input type="text" id="expenseName" required />
      <label for="expenseAmount">Monto ($)</label>
      <input type="number" id="expenseAmount" min="0" step="0.01" required />
      <label for="expenseType">Tipo</label>
      <select id="expenseType">
        <option value="fijo">Fijo</option>
        <option value="variable">Variable</option>
      </select>
      <button type="submit" class="btn">Agregar Gasto</button>
    </form>
    <table id="expensesTable">
      <thead>
        <tr><th>Nombre</th><th>Monto</th><th>Tipo</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ingresos -->
  <section id="incomes">
    <h2>Ingresos</h2>
    <form id="incomeForm">
      <label for="incomeName">Concepto</label>
      <input type="text" id="incomeName" required />
      <label for="incomeAmount">Monto ($)</label>
      <input type="number" id="incomeAmount" min="0" step="0.01" required />
      <label for="incomeFreq">Frecuencia</label>
      <select id="incomeFreq">
        <option value="mensual">Mensual</option>
        <option value="única">Única</option>
      </select>
      <button type="submit" class="btn">Agregar Ingreso</button>
    </form>
    <table id="incomesTable">
      <thead>
        <tr><th>Concepto</th><th>Monto</th><th>Frecuencia</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Metas -->
  <section id="goals">
    <h2>Metas Financieras</h2>
    <form id="goalForm">
      <label for="goalName">Nombre de la Meta</label>
      <input type="text" id="goalName" required />
      <label for="goalAmount">Monto Objetivo ($)</label>
      <input type="number" id="goalAmount" min="0" step="0.01" required />
      <label for="goalDate">Fecha Objetivo</label>
      <input type="date" id="goalDate" />
      <label for="goalPriority">Prioridad</label>
      <select id="goalPriority">
        <option value="alta">Alta</option>
        <option value="media">Media</option>
        <option value="baja">Baja</option>
      </select>
      <button type="submit" class="btn">Agregar Meta</button>
    </form>
    <div id="goalsList" style="margin-top:1rem;"></div>
  </section>

  <!-- Simulador -->
  <section id="simulator">
    <h2>Simulador de Escenarios</h2>
    <form id="scenarioForm">
      <label for="scenarioType">Tipo de Escenario</label>
      <select id="scenarioType">
        <option value="perdidaEmpleo">Pérdida de empleo</option>
        <option value="gastoImprevisto">Gasto imprevisto</option>
        <option value="aumentoIngreso">Aumento de ingresos</option>
      </select>
      <label for="scenarioValue">Valor (meses o porcentaje)</label>
      <input type="number" id="scenarioValue" min="0" step="1" />
      <button type="submit" class="btn">Simular 12 meses</button>
    </form>
    <canvas id="simulationChart" style="margin-top:1rem;"></canvas>
    <div id="simulationResults" style="margin-top:1rem;"></div>
  </section>
</main>

<div id="notification" class="notification"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(() => {
  // Estado general
  const STORAGE_KEY = 'finanzas_empresariales_v1';
  let state = {
    assets: [],
    liabilities: [],
    expenses: [],
    incomes: [],
    goals: [],
    settings: {
      savingsPct: 20,
      reservePct: 10,
      cutPct: 20,
    },
    balance: 0,
    savings: 0,
    reservedBudget: 0,
  };

  // Cargar y guardar estado
  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }
  function loadState() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) {
      try {
        state = JSON.parse(raw);
      } catch(e) {
        console.error('Error al cargar estado', e);
      }
    }
  }

  // UI Helpers
  function formatCurrency(v) {
    return '$ ' + Number(v).toLocaleString('es-PE', {minimumFractionDigits: 2, maximumFractionDigits: 2});
  }
  function showNotification(msg) {
    const el = document.getElementById('notification');
    el.textContent = msg;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 3000);
  }

  // Navegación
  const navButtons = document.querySelectorAll('nav button.nav-btn');
  navButtons.forEach(btn => btn.addEventListener('click', () => {
    navButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('main > section').forEach(s => s.classList.remove('active'));
    document.getElementById(btn.dataset.section).classList.add('active');
  }));

  // Render tables
  function renderAssets() {
    const tbody = document.querySelector('#assetsTable tbody');
    tbody.innerHTML = '';
    state.assets.forEach((a, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${a.name}</td>
        <td>${formatCurrency(a.value)}</td>
        <td>${formatCurrency(a.income)}</td>
        <td><button onclick="removeAsset(${i})">Eliminar</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderLiabilities() {
    const tbody = document.querySelector('#liabilitiesTable tbody');
    tbody.innerHTML = '';
    state.liabilities.forEach((l, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${l.name}</td>
        <td>${formatCurrency(l.total)}</td>
        <td>${formatCurrency(l.monthly)}</td>
        <td><button onclick="removeLiability(${i})">Eliminar</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderExpenses() {
    const tbody = document.querySelector('#expensesTable tbody');
    tbody.innerHTML = '';
    state.expenses.forEach((e, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${e.name}</td>
        <td>${formatCurrency(e.amount)}</td>
        <td>${e.type}</td>
        <td><button onclick="removeExpense(${i})">Eliminar</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderIncomes() {
    const tbody = document.querySelector('#incomesTable tbody');
    tbody.innerHTML = '';
    state.incomes.forEach((i, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i.name}</td>
        <td>${formatCurrency(i.amount)}</td>
        <td>${i.freq}</td>
        <td><button onclick="removeIncome(${idx})">Eliminar</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderGoals() {
    const list = document.getElementById('goalsList');
    list.innerHTML = '';
    state.goals.forEach((g,i) => {
      const div = document.createElement('div');
      div.style.border = '1px solid #d1d5db';
      div.style.padding = '0.5rem';
      div.style.marginBottom = '0.5rem';
      div.innerHTML = `
        <div><strong>${g.name}</strong> - ${formatCurrency(g.amount)}<br>
        Fecha: ${g.date || 'No definida'}, Prioridad: ${g.priority}</div>
        <button onclick="removeGoal(${i})" style="margin-top:0.5rem;">Eliminar</button>
      `;
      list.appendChild(div);
    });
  }

  // Add Remove Functions
  window.removeAsset = function(i) { state.assets.splice(i, 1); saveState(); renderAssets(); updateSummary(); showNotification('Activo eliminado'); }
  window.removeLiability = function(i) { state.liabilities.splice(i, 1); saveState(); renderLiabilities(); updateSummary(); showNotification('Pasivo eliminado'); }
  window.removeExpense = function(i) { state.expenses.splice(i, 1); saveState(); renderExpenses(); updateSummary(); showNotification('Gasto eliminado'); }
  window.removeIncome = function(i) { state.incomes.splice(i, 1); saveState(); renderIncomes(); updateSummary(); showNotification('Ingreso eliminado'); }
  window.removeGoal = function(i) { state.goals.splice(i, 1); saveState(); renderGoals(); showNotification('Meta eliminada'); }

  // Add submit event handlers
  document.getElementById('assetForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = e.target.assetName.value.trim();
    const value = Number(e.target.assetValue.value);
    const income = Number(e.target.assetIncome.value) || 0;
    if (!name || value < 0) return alert('Datos inválidos');
    state.assets.push({name, value, income});
    saveState();
    renderAssets();
    updateSummary();
    e.target.reset();
    showNotification('Activo agregado');
  });
  document.getElementById('liabilityForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = e.target.liabName.value.trim();
    const total = Number(e.target.liabTotal.value);
    const monthly = Number(e.target.liabMonthly.value);
    if (!name || total < 0 || monthly < 0) return alert('Datos inválidos');
    state.liabilities.push({name, total, monthly});
    saveState();
    renderLiabilities();
    updateSummary();
    e.target.reset();
    showNotification('Pasivo agregado');
  });
  document.getElementById('expenseForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = e.target.expenseName.value.trim();
    const amount = Number(e.target.expenseAmount.value);
    const type = e.target.expenseType.value;
    if (!name || amount < 0) return alert('Datos inválidos');
    state.expenses.push({name, amount, type});
    saveState();
    renderExpenses();
    updateSummary();
    e.target.reset();
    showNotification('Gasto agregado');
  });
  document.getElementById('incomeForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = e.target.incomeName.value.trim();
    const amount = Number(e.target.incomeAmount.value);
    const freq = e.target.incomeFreq.value;
    if (!name || amount < 0) return alert('Datos inválidos');
    state.incomes.push({name, amount, freq});
    saveState();
    renderIncomes();
    updateSummary();
    e.target.reset();
    showNotification('Ingreso agregado');
  });
  document.getElementById('goalForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = e.target.goalName.value.trim();
    const amount = Number(e.target.goalAmount.value);
    const date = e.target.goalDate.value;
    const priority = e.target.goalPriority.value;
    if (!name || amount < 0) return alert('Datos inválidos');
    state.goals.push({name, amount, date, priority});
    saveState();
    renderGoals();
    showNotification('Meta agregada');
    e.target.reset();
  });

  // Cálculos y render resumen
  function updateSummary() {
    // Calcular ingresos mensuales (solo mensuales)
    const ingresosMensuales = state.incomes.reduce((sum, i) => (i.freq === 'mensual' ? sum + i.amount : sum), 0);
    // Ingresos pasivos de activos
    const ingresosPasivos = state.assets.reduce((sum, a) => sum + a.income, 0);
    // Total gastos fijos
    const gastosFijos = state.expenses.filter(e => e.type === 'fijo').reduce((sum, e) => sum + e.amount, 0);
    // Cuotas pasivos mensuales
    const cuotasPasivos = state.liabilities.reduce((sum, l) => sum + l.monthly, 0);
    // Balance: ingresos - gastos - pasivos
    let balance = ingresosMensuales + ingresosPasivos - gastosFijos - cuotasPasivos;
    // Distribución automática: ahorro y reservas
    const ahorro = (balance * state.settings.savingsPct) / 100;
    const reserva = (balance * state.settings.reservePct) / 100;
    const disponible = balance - ahorro - reserva;
    state.balance = disponible < 0 ? 0 : disponible;
    state.savings = ahorro < 0 ? 0 : ahorro;
    state.reservedBudget = reserva < 0 ? 0 : reserva;
    // Mostrar en DOM
    document.getElementById('balanceDisplay').textContent = formatCurrency(state.balance);
    document.getElementById('savingsDisplay').textContent = formatCurrency(state.savings);
    document.getElementById('passiveIncomeDisplay').textContent = formatCurrency(ingresosPasivos);
    document.getElementById('fixedExpensesDisplay').textContent = formatCurrency(gastosFijos+cuotasPasivos);
    // Actualizar gráfico
    updateChart([state.balance, state.savings, ingresosPasivos, gastosFijos+cuotasPasivos]);
  }

  // Inicializar Chart.js resumen
  const ctxSummary = document.getElementById('summaryChart').getContext('2d');
  let summaryChart = new Chart(ctxSummary, {
    type: 'bar',
    data: {
      labels: ['Balance Disponible', 'Ahorros', 'Ingresos Pasivos', 'Gastos Fijos + Cuotas'],
      datasets: [{
        label: 'Montos ($)',
        data: [0,0,0,0],
        backgroundColor: ['#0f766e','#34d399','#a3e635','#ef4444']
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: {display: false} },
      scales: { y: {beginAtZero: true} }
    }
  });
  function updateChart(data) {
    summaryChart.data.datasets[0].data = data;
    summaryChart.update();
  }

  // Simulador
  document.getElementById('scenarioForm').addEventListener('submit', e => {
    e.preventDefault();
    const type = e.target.scenarioType.value;
    const val = Number(e.target.scenarioValue.value);
    simulateScenario(type, val);
  });

  function simulateScenario(type, val) {
    const results = [];
    const baseIncome = state.incomes.reduce((sum, i) => sum + (i.freq === 'mensual' ? i.amount : 0), 0); 
    const passiveIncome = state.assets.reduce((sum, a) => sum + a.income, 0);
    const fixedExpenses = state.expenses.filter(e => e.type === 'fijo').reduce((sum,e) => sum + e.amount, 0);
    const monthlyLiabilities = state.liabilities.reduce((sum, l) => sum + l.monthly, 0);

    let currentBalance = baseIncome + passiveIncome - fixedExpenses - monthlyLiabilities;

    for(let month = 1; month <= 12; month++) {
      // Ajustes de escenario
      let adjustedIncome = baseIncome;
      if(type === 'perdidaEmpleo' && month <= val) adjustedIncome = 0;
      if(type === 'gastoImprevisto' && month === 1) currentBalance -= val;
      if(type === 'aumentoIngreso') adjustedIncome = baseIncome * (1 + val/100);

      currentBalance += adjustedIncome + passiveIncome - fixedExpenses - monthlyLiabilities;
      results.push({month, balance: currentBalance});
    }

    // Mostrar resultados
    const resDiv = document.getElementById('simulationResults');
    resDiv.innerHTML = '<h3>Proyección 12 meses</h3><ul>' + results.map(r => `<li>Mes ${r.month}: ${formatCurrency(r.balance)}</li>`).join('') + '</ul>';

    // Gráfico
    const ctxSim = document.getElementById('simulationChart').getContext('2d');
    if(window.simChart) window.simChart.destroy();
    window.simChart = new Chart(ctxSim, {
      type: 'line',
      data: {
        labels: results.map(r => 'Mes ' + r.month),
        datasets: [{label: 'Balance $', data: results.map(r => r.balance), fill: false, borderColor: '#0f766e', tension: 0.2}]
      },
      options: { responsive: true, plugins: { legend: { display: true } } }
    });
  }

  // Inicializar
  function init() {
    loadState();
    renderAssets();
    renderLiabilities();
    renderExpenses();
    renderIncomes();
    renderGoals();
    updateSummary();
  }

  init();
})();
</script>
<footer>© 2025 Control Financiero Empresarial</footer>
</body>
</html>



